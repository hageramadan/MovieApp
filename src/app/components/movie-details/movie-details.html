<!-- Loading عام -->
<div class="loading-container text-center" *ngIf="isLoading">
  <i class="fa-solid fa-spinner fa-spin fa-3x text-warning"></i>
</div>

@if (!loading && movie?.poster_path) {
  <section
    class="details"
    *ngIf="movie"
    [ngStyle]="{
      'background-image': movie.backdrop_path 
        ? 'url(https://image.tmdb.org/t/p/original' + movie.backdrop_path + ')' 
        : 'url(assets/no-bg.jpg)',
      'background-size': 'cover',
      'background-position': 'center',
      'background-repeat': 'no-repeat'
    }"
  >
    <div class="overlay">
      <div class="container py-5">
        <div class="row mt-5">
          <!-- صورة الفيلم -->
          <div class="col-md-4 mt-4 position-relative">
            <!-- Loading Spinner للصورة -->
            <div class="loading-spinner" *ngIf="!isPosterLoaded && !isPosterError">
              <i class="fa-solid fa-spinner fa-spin fa-2x text-light"></i>
            </div>

            <!-- Poster -->
            <img
              *ngIf="!isPosterError"
              [src]="'https://image.tmdb.org/t/p/w500' + movie.poster_path"
              [alt]="movie.title"
              class="img-fluid rounded shadow-lg"
              (load)="onPosterLoad()"
              (error)="onPosterError()"
              [hidden]="!isPosterLoaded"
            />

            <!-- fallback not_found -->
            <img
              *ngIf="isPosterError"
              src="assets/not_found.png"
              alt="not found"
              class="img-fluid rounded shadow-lg"
            />
          </div>

          <!-- تفاصيل الفيلم -->
          <div class="col-md-8 item text-light mt-5">
            <h2>{{ movie.title }}</h2>
            <p class="loremDate">{{ movie.release_date | date: 'longDate' }}</p>

            <!-- التقييم -->
            <div class="stars mt-3" *ngIf="movie?.vote_average">
              <i class="fa-solid fa-star text-warning" *ngFor="let _ of fillStar"></i>
              <i class="fa-solid fa-star-half-stroke text-warning" *ngIf="halfStar"></i>
              <i class="fa-regular fa-star text-warning" *ngFor="let _ of emptyStar"></i>
            </div>

            <div class="long-p">
              <p>{{ movie.overview }}</p>
            </div>

            <!-- بيانات إضافية -->
            <div class="d-flex flex-wrap gap-4 mt-4">
              <div class="d-flex gap-2">
                <h6>Duration:</h6>
                <p>{{ movie.runtime }} Min</p>
              </div>
              <div class="d-flex gap-2">
                <h6>Language:</h6>
                <p>{{ movie.original_language | uppercase }}</p>
              </div>
              <div class="d-flex gap-2" *ngIf="movie.vote_average">
                <h6>Rating:</h6>
                <p>{{ movie.vote_average | number: '1.1-1' }}/10</p>
              </div>
              <div class="d-flex gap-2" *ngIf="movie.genres?.length">
                <h6>Genres:</h6>
                <p>
                  <span *ngFor="let g of movie.genres; let last = last">
                    {{ g.name }}<span *ngIf="!last">, </span>
                  </span>
                </p>
              </div>
            </div>

            <!-- زرار الموقع الرسمي -->
            <button
              *ngIf="movie.homepage"
              class="btn btn-outline-light mt-4"
              (click)="openWebsite(movie.homepage)"
            >
              Website <i class="fa-solid fa-link ms-1"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Recommendations -->
  <section class="recommendations container my-5">
    <h2 class="my-5">Recommendations</h2>
    <div class="row g-4 mb-5">
      <div class="col-6 col-md-4 col-lg-2" *ngFor="let m of movies">
        <app-movie-card [movie]="m"></app-movie-card>
      </div>
    </div>
  </section>
}
@else if (showNotFound || !loading){
  <div class="hight4 text-center">
    <img src="assets/noMovie.png" alt="noMovie" class="mt-5" />
    <h4>Movie Not Found</h4>
    <button class="btn btn-warning px-5" routerLink="">Back to Home</button>
  </div>
}


